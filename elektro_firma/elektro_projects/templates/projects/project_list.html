{% extends 'base.html' %}

{% block content %}
<h2>Seznam projektů</h2>

<form method="get" class="mb-3">
    <div class="row">
        <div class="col-md-4">
            <select name="customer" class="form-select">
                <option value="">Filtr podle zákazníka</option>
                {% for customer in customers %}
                    <option value="{{ customer.id }}" {% if request.GET.customer == customer.id|stringformat:"s" %}selected{% endif %}>{{ customer.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4">
            <select name="person" class="form-select">
                <option value="">Filtr podle zaměstnance</option>
                {% for person in persons %}
                    <option value="{{ person.id }}" {% if request.GET.person == person.id|stringformat:"s" %}selected{% endif %}>{{ person.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4">
            <button type="submit" class="btn btn-primary w-100">Filtruj</button>
        </div>
    </div>
</form>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Jméno projektu</th>
            <th>Adresa</th>
            <th>Zákazník</th>
            <th>Přidělené osoby</th>
            <th>Akce</th>
        </tr>
    </thead>
    <tbody>
        {% for project in projects %}
        <tr>
            <td>{{ project.name }}</td>
            <td>{{ project.address }}</td>
            <td>{{ project.customer.name }}</td>
            <td>
                <ul>
                    {% for person in project.assigned_persons.all %}
                        <li>{{ person.username }}</li>  <!-- Opraveno pro správné zobrazení jména osoby -->
                    {% endfor %}
                </ul>
            </td>
            <td>
                <a href="{% url 'project-detail' project.id %}" class="btn btn-info btn-sm">Zobrazit</a>
                {% if request.user == project.owner %}
                    <a href="{% url 'project-edit' project.id %}" class="btn btn-warning btn-sm">Editovat</a>
                    <a href="{% url 'project-delete' project.id %}" class="btn btn-danger btn-sm">Smazat</a>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="5" class="text-center">Žádné projekty nenalezeny.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
